<div class="modal" data-modal="true" id="book_modal">
	<div class="modal-content max-w-[600px] top-[15%]">
		<div class="modal-header py-4 px-5">
			<h3 class="modal-title">Ma lecture</h3>
		</div>
		<div class="modal-body p-0 pb-5">
			<div class="scrollable-y-auto" data-scrollable="true" data-scrollable-max-height="auto" data-scrollable-offset="300px">
				{{ form_start(form) }}
				<div class="flex flex-col gap-5 p-5">
					<div class="flex flex-col gap-1">
						<label for="book" class="form-label font-normal text-gray-900">Livre</label>
						{{ form_widget(form.book_id) }}
					</div>

					<div class="flex flex-col gap-1">
						<label for="description" class="form-label font-normal text-gray-900">Mes notes</label>
						<div class="flex flex-col w-full gap-1">
							{{ form_widget(form.description) }}
						</div>
					</div>

					<div class="flex flex-col gap-1">
						<label for="rating" class="form-label font-normal text-gray-900">Note</label>
						{{ form_widget(form.rating) }}
					</div>

					<div class="flex flex-col gap-1">
						<label class="switch">
							<span class="switch-label font-normal text-gray-900">Lecture terminée</span>
							{{ form_widget(form.is_read) }}
						</label>
					</div>

					<div class="flex">
						<button type="submit" class="btn btn-primary">Enregistrer</button>
					</div>

					<div id="form-messages" />
				</div>
				{{ form_end(form) }}
			</div>
		</div>
	</div>
</div>

<script>
document.getElementById('book-read-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);

    fetch(form.action, {
        method: form.method,
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest', // tells it is AJAX request
        },
    })
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Ajout échoué');
    })
    .then(data => {
        const messageDiv = document.getElementById('form-messages');
        messageDiv.textContent = data.message;
    })
    .catch(error => {
        const messageDiv = document.getElementById('form-messages');
        messageDiv.textContent = error.message;
    });
});
</script>
